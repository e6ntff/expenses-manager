"use strict";(self.webpackChunkexpenses_manager=self.webpackChunkexpenses_manager||[]).push([[523],{523:(e,t,r)=>{r.r(t),r.d(t,{default:()=>I});var n=r(2791),a=r(7257),s=r(4320),o=r(7201),l=r(43),i=r(2556),c=r(3936),d=r(1429),u=r(4664),y=r(4554),p=r(3623),h=r(8416),g=r(8418),m=r(5967),v=r(6619),x=r(7703),j=r(184);m.kL.register(m.u,m.vn,m.ZL,m.uw,m.f$);const f=(0,a.Pi)((e=>{let{list:t,interval:r,setInterval:a}=e;const{isSmallScreen:s}=y.userStore,{statsOptions:l,userOptions:i}=x.optionsStore,{currency:c,language:d}=i,{year:u}=l,m=(0,n.useMemo)((()=>"year"===r?(0,v.MF)(t,c):(0,v.W3)(t,u,c)),[c,t,r,u]),f={labels:"month"===r?h.Z.months[d]:Object.keys(m),datasets:[{label:(0,g.R)(c),data:Object.values(m),backgroundColor:"#f00"}]},S={plugins:{legend:{display:!1}},onClick:(e,t)=>{if(t.length){const e=t[0].index;a("year"===r?Number(f.labels[e]):e)}else a(null)}};return(0,j.jsx)(o.Z,{style:{inlineSize:s?"unset":"50%"},children:(0,j.jsx)(p.$Q,{data:f,options:S})})}));m.kL.register(m.qi,m.tt,m.u,m.De,m.Dx);const S=(0,a.Pi)((e=>{let{list:t,interval:r}=e;const{isSmallScreen:a}=y.userStore,{statsOptions:s,userOptions:l}=x.optionsStore,{currency:i}=l,{year:c,month:d,day:u}=s,h=(0,n.useMemo)((()=>"year"===r?(0,v.wF)(t,i):"month"===r?(0,v.Wu)(t,c,d,i):(0,v.X2)(t,c,d,u,i)),[t,i,r,c,d,u]),[m,f,S]=[h.map((e=>e.category.name)),h.map((e=>e.category.color)),h.map((e=>Math.round(e.value)))],Z={labels:m,datasets:[{label:(0,g.R)(i),data:S,backgroundColor:f}]};return(0,j.jsx)(o.Z,{style:{inlineSize:a||"day"===r?"unset":"40%"},children:(0,j.jsx)(p.by,{data:Z,options:{plugins:{legend:{display:!0,position:"right"}}}})})}));var Z=r(9372),M=r(9168),b=r(3475),k=r(5160),w=r(6203),E=r(4358),O=r(7892),C=r.n(O),D=r(4878);const P=(0,a.Pi)((e=>{let{opened:t,toggleOpened:r}=e;const{list:a}=s.listStore,{statsOptions:l,userOptions:i,setYear:c,setMonth:d,setDay:u}=x.optionsStore,{currency:y}=i,{year:p,month:h,day:m}=l,[f,Z]=(0,n.useState)(!1),M=(0,n.useMemo)((()=>(0,v.nH)(a,y,p,h)),[p,h,y,a]),b=(0,n.useMemo)((()=>(0,v.nH)(a,y,p,h,m)),[p,h,m,y,a]);(0,n.useEffect)((()=>{m&&b[m]?Z(!0):Z(!1)}),[m,b]);return(0,j.jsx)(w.Z,{open:t,onCancel:r,okButtonProps:{style:{display:"none"}},cancelButtonProps:{style:{display:"none"}},children:(0,j.jsxs)(o.Z,{vertical:!0,align:"center",children:[(0,j.jsx)(E.Z,{cellRender:(e,t)=>{const r="date"===t.type?e.date():e.month(),n="date"===t.type?b[r]:M[r];return(0,j.jsx)(o.Z,{vertical:!0,justify:"center",align:"center",children:(0,j.jsx)(k.Z.Text,{strong:!0,children:n?(0,g.R)(y,n):"-"})})},fullscreen:!1,validRange:[D.Z.startDate,C()()],value:C()(new Date(p,h||0,m||1)),onChange:e=>{c(e.year()),d(e.month()),u(e.date())}}),f&&(0,j.jsx)(S,{list:a,interval:"day"})]})})})),R=(0,a.Pi)((()=>{const{list:e}=s.listStore,{isSmallScreen:t}=y.userStore,{statsOptions:r,userOptions:a,setYear:p,setMonth:m,setDay:v}=x.optionsStore,{language:k,currency:w}=a,[E,O]=(0,n.useState)(!1),{year:C,month:D}=r,R=(0,n.useCallback)((()=>{O((e=>!e))}),[O]),I=(0,n.useMemo)((()=>e.reduce(((e,t)=>e+t.price[w]),0)),[e,w]),F=(0,n.useMemo)((()=>e.filter((e=>e.date.year()===C))),[C,e]),L=(0,n.useCallback)((e=>F.reduce(((t,r)=>r.date.month()!==e&&e?t:t+r.price[w]),0)),[F,w]),U=(0,n.useCallback)((()=>{D?(m(null),v(null)):C&&p(null)}),[m,p,v,D,C]);return(0,n.useEffect)((()=>{const e=e=>{"Escape"!==e.key||E||U()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[U,E]),s.listStore.loading||b.categoryStore.loading?(0,j.jsx)(o.Z,{justify:"center",children:(0,j.jsx)(l.Z,{})}):e.length?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(o.Z,{gap:16,children:[C&&(0,j.jsxs)(o.Z,{vertical:!0,justify:"space-between",children:[(0,j.jsx)(i.ZP,{onClick:U,children:(0,j.jsx)(Z.Z,{})}),(0,j.jsx)(i.ZP,{onClick:R,children:(0,j.jsx)(M.Z,{})})]}),(0,j.jsx)(c.Z,{bordered:!1,size:"small",children:(0,j.jsx)(d.Z,{title:"".concat(C?h.Z.In[k]:h.Z.total[k]," ").concat(null!==D?h.Z.months[k][D]:""," ").concat(C||""),value:Math.round(C?L(D):I),prefix:(0,g.R)(w),valueStyle:{color:"#f00"}})}),(0,j.jsx)(P,{opened:E,toggleOpened:R})]}),(0,j.jsx)(o.Z,{align:"center",justify:"space-between",style:{flexDirection:t?"column-reverse":"row"},children:C?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(f,{list:F,interval:"month",setInterval:m}),(0,j.jsx)(S,{list:F,interval:"month"})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(f,{list:e,interval:"year",setInterval:p}),(0,j.jsx)(S,{list:e,interval:"year"})]})})]}):(0,j.jsx)(u.Z,{image:u.Z.PRESENTED_IMAGE_SIMPLE,description:""})})),I=(0,n.memo)(R)},6619:(e,t,r)=>{r.d(t,{MF:()=>l,W3:()=>i,Wu:()=>d,X2:()=>u,ky:()=>a,ls:()=>s,nH:()=>o,wF:()=>c});var n=r(8418);const a=(e,t,r)=>{const{years:a,categoriesToFilter:s,sortingAlgorithm:o,isSortingReversed:l}=e;return a||s?(0,n.M)(t.filter((e=>!s.length&&a.length?a.some((t=>e.date.year().toString()===t)):!a.length&&s.length?s.some((t=>e.category.id===t.id)):a.length&&s.length?a.some((t=>e.date.year().toString()===t))&&s.some((t=>e.category.id===t.id)):e)),o,l,r):(0,n.M)(t,o,l,r)},s=(e,t)=>{const{currentPage:r,pageSize:n}=e,a=(r-1)*n,s=a+n;return t.slice(a,s)},o=(e,t,r,n,a)=>{const s=new Array(void 0===a?12:31).fill(0);return e.forEach((e=>{void 0===a?e.date.year()===r&&(s[e.date.month()]+=e.price[t]):e.date.year()===r&&e.date.month()===n&&(s[e.date.date()]+=e.price[t])}),[]),s.map((e=>Math.round(e)))},l=(e,t)=>{const r={};e.forEach((e=>{const n=e.date.year().toString();void 0===r[n]?r[n]=0:r[n]+=e.price[t]}));for(let n in r)r[n]=Math.round(r[n]);return r},i=(e,t,r)=>{const n=new Array(12).fill(0);return e.forEach((e=>{if(e.date.year()===t){const t=e.date.month();n[t]+=e.price[r]}})),n.map((e=>Math.round(e)))},c=(e,t)=>{const r=[];return e.forEach((e=>{const n=r.findIndex((t=>t.category.id===e.category.id));-1!==n?r[n].value+=e.price[t]:r.push({category:e.category,value:e.price[t]})})),r.map((e=>({...e,value:Math.round(e.value)})))},d=(e,t,r,n)=>{const a=[];return e.forEach((e=>{const s=a.findIndex((t=>t.category.id===e.category.id));e.date.year()!==t||null!==r&&e.date.month()!==r||(-1!==s?a[s].value+=e.price[n]:a.push({category:e.category,value:e.price[n]}))})),a.map((e=>({...e,value:Math.round(e.value)})))},u=(e,t,r,n,a)=>{const s=[];return e.forEach((e=>{const o=s.findIndex((t=>t.category.id===e.category.id));e.date.date()===n&&e.date.month()===r&&e.date.year()===t&&(-1!==o?s[o].value+=e.price[a]:s.push({category:e.category,value:e.price[a]}))})),s.map((e=>({...e,value:Math.round(e.value)})))}},8418:(e,t,r)=>{r.d(t,{M:()=>a,R:()=>n});const n=(e,t)=>{var r;let n="";"USD"===e&&(n+="$"),"EUR"===e&&(n+="\u20ac"),"RUB"===e&&(n+="\u20bd");const a=null===(r=Math.round(t))||void 0===r?void 0:r.toString().split("").reverse().reduce(((e,t,r)=>r%3===0&&0!==r?[...e,t+","]:[...e,t]),[]).reverse().join("");return void 0===t?n:n+a},a=(e,t,r,n)=>{let a;switch(t){case"date":a=[...e].sort(((e,t)=>t.date.valueOf()-e.date.valueOf()));break;case"title":a=[...e].sort(((e,t)=>e.title.localeCompare(t.title,n,{sensitivity:"base"})));break;case"price":a=[...e].sort(((e,t)=>t.price.USD-e.price.USD));break;default:a=[...e]}return r?a.reverse():a}}}]);
//# sourceMappingURL=523.c2d8de24.chunk.js.map